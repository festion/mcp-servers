[SERVICE]
    flush         1
    log_level     info
    daemon        off
    parsers_file  parsers.conf
    http_server   on
    http_listen   0.0.0.0
    http_port     2020
    storage.metrics on

[INPUT]
    name              tail
    path              /var/log/runner/*.log
    parser            docker
    tag               runner.*
    refresh_interval  5
    mem_buf_limit     5MB
    skip_long_lines   on

[INPUT]
    name              tail
    path              /var/log/runner/jobs/*.log
    parser            github_actions
    tag               runner.jobs.*
    refresh_interval  5
    mem_buf_limit     5MB
    skip_long_lines   on

[INPUT]
    name              systemd
    tag               host.systemd
    systemd_filter    _SYSTEMD_UNIT=docker.service
    read_from_tail    on

[INPUT]
    name              docker
    tag               docker.*
    include           github-runner,runner-health-monitor,runner-metrics-collector,runner-log-aggregator
    docker_mode       on
    buffer_size       32k

[FILTER]
    name                kubernetes
    match               docker.*
    merge_log           on
    keep_log            off
    k8s-logging.parser  on
    k8s-logging.exclude off

[FILTER]
    name                modify
    match               runner.*
    add                 service github-actions-runner
    add                 environment production
    add                 component runner

[FILTER]
    name                modify
    match               docker.*
    add                 service github-actions-runner
    add                 environment production
    add                 component container

[FILTER]
    name                grep
    match               *
    exclude             level debug

[FILTER]
    name                throttle
    match               *
    rate                1000
    window              300
    interval            1s

[OUTPUT]
    name                forward
    match               *
    host                ${FLUENT_ELASTICSEARCH_HOST}
    port                ${FLUENT_ELASTICSEARCH_PORT}
    shared_key          fluentd
    self_hostname       github-runner-fluent-bit
    tls                 off
    tls.verify          off

[OUTPUT]
    name                stdout
    match               runner.jobs.*
    format              json_lines

[OUTPUT]
    name                file
    match               runner.*
    path                /var/log/runner
    file                runner.log
    format              json_lines